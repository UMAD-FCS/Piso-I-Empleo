---
title: '**<br /> <br /> Empleo, salarios y transferencias**'
output:
  html_document:
    theme: flatly
    toc: yes
    toc_float: yes
    smooth_scroll: yes
    toc_depth: 2
    number_sections: false 
    css: "www/estilo.css"
  pdf_document:
    toc: yes
    toc_depth: '2'
---




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r}
htmltools::img(src = knitr::image_uri("www/logo_umad.png"), 
               alt = 'logo', 
               style = 'position:absolute; top:0; right:0; padding:15px;max-width: 45%;')

suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(plotly))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(DT))
suppressPackageStartupMessages(library(kableExtra))
suppressPackageStartupMessages(library(dplyr))


base        <- readxl::read_excel("Data/Base_motor_empleo_2792022.xlsx")
base_fichas <- readxl::read_excel("Data/Base_Fichas_Técnicas.xls")
base_fichas <- base_fichas[order(base_fichas$ID),]

```

<br />
<br />

<div style="text-align: justify">
**La [Unidad de Métodos y Acceso a Datos](https://umad.cienciassociales.edu.uy/) (UMAD) (FCS-UdelaR) a partir del [Observatorio Uruguay](https://umad.cienciassociales.edu.uy/observatorio-uruguay/) busca aportar a la difusión de conocimiento respecto a temas de interés general sobre la realidad social, económica y política del Uruguay. Esta serie de documentos tiene como objetivo presentar indicadores clave para el análisis de tendencias históricas del país que esperamos sean de utilidad para las comunidades académicas, los tomadores de decisión y los formadores de opinión, así como el público en general. Se presentan aquí indicadores sobre empleo, salarios y transferencias en el Uruguay durante las últimas décadas.** 
</div>

<hr style="border:1.5px solid #2c3e50"> </hr>


<br />

# **Caracterización del mercado de empleo** 
## **Actividad**


<div style="text-align: justify">

La tasa de actividad es un indicador de la predisposición de las personas a participar en el mercado de empleo. La misma se calcula como el porcentaje de la población activa sobre la población en edad de trabajar.
										
La población activa refiere a todas las personas ocupadas o que, no estando ocupadas, se encuentran buscando empleo activamente. 

La población en edad de trabajar designa a la población que ha cumplido la edad mínima legal para trabajar que, en el caso de Uruguay corresponde a los 15 años. Sin embargo,  a efectos estadísticos se la define como todas las personas cuyas edades superan una edad mínima específica para la que se realiza una encuesta sobre la actividad económica, 14 años en el caso de las Encuestas Continuas de Hogares.

		
</div>


<div style="text-align: justify">

Desde la década del noventa la tasa de actividad ha osicilado en el país urbano entre 57% y 65%. En las últimas tres décadas se observa una tendencia leve al aumento, exceptuando los años comprendidos entre 2001 y 2003. Si bien el indicador tiende a mantener una relativa estabilidad ha cambiado signficiativamente la composición de las personas activas. Se registra un aumento significativo de la tasa de actividad entre las mujeres y una reducción de 18 puntos porcentuales de la brecha según sexo. A la vez, se reduce de forma signifciativa la tasa entre las personas adolescentes y jóvenes de 14 a 24 años. 										
</div>

<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE ACTIVIDAD",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de actividad**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================

g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE ACTIVIDAD", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="TASA DE ACTIVIDAD" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  ylim(0, 100) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE ACTIVIDAD", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [2,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [2,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Población económicamente activa

sem1 <- sem1 %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 | 
                                              POBPCOAC==3 | 
                                              POBPCOAC==4 | 
                                              POBPCOAC==5, 1, 0))
sem2_panel <- sem2_panel %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 |
                                                          POBPCOAC==3 | 
                                                          POBPCOAC==4 | 
                                                          POBPCOAC==5, 1, 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de actividad

a_mes <- sem1_svy %>%
  srvyr::filter(E27>=14 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(pea, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_panel_svy %>%
  srvyr::filter(e27>=14 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(pea, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [2,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 

<br />

<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE ACTIVIDAD",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de actividad, según sexo**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE ACTIVIDAD", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "VARONES"|SEXO=="MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  SEXO =="VARONES" ~ "Varones", SEXO == "MUJERES" ~ "Mujeres"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 2, color = UNIDAD))+
  scale_color_manual(
    values = c(639, "#a1dd70"),
    labels = c("Varones", "Mujeres")
  ) +
  ylim(0, 100) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE ACTIVIDAD", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "VARONES"|SEXO == "MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","SEXO","ANIO","VALOR")]
t1 <- t1[order(t1$SEXO, t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 

```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [2,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [2,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Población económicamente activa

sem1 <- sem1 %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 | 
                                              POBPCOAC==3 | 
                                              POBPCOAC==4 | 
                                              POBPCOAC==5, 1, 0))
sem2_panel <- sem2_panel %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 |
                                                          POBPCOAC==3 | 
                                                          POBPCOAC==4 | 
                                                          POBPCOAC==5, 1, 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de actividad según sexo 

a_sexo <- function(x) {
  x <- sem1_svy %>%
    filter(bc_pe2 == x & E27>=14 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(pea, na.rm=T))
  x <- mean(x$colname)
}       

a_e_sexo <- numeric()

for(i in 1:2){
  a_e_sexo[i] <- a_sexo(x = i)
}     

b_sexo <- function(x) {
  x <- sem2_panel_svy %>%
    filter(bc_pe2 == x & e27>=14 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(pea, na.rm=T))
  x <- mean(x$colname)
}       

b_e_sexo <- numeric()

for(i in 1:2){
  b_e_sexo[i] <- b_sexo(x = i)
}     


c_sexo_pu <- as.data.frame(cbind(a_e_sexo, b_e_sexo))
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(VALOR = (a_e_sexo + b_e_sexo)/2)
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(aux = c(9, 10))
c_sexo_pu <- c_sexo_pu[,c("VALOR", "aux")]

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```


## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [2,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 




<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE ACTIVIDAD",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de actividad, según tramo de edad**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- base %>% 
  filter(NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 14 A 18 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 19 A 24 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 25 A 29 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 30 A 64 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 65 AÑOS Y MÁS", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 14 A 18 AÑOS"~ "14 a 18 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 19 A 24 AÑOS"~ "19 a 24 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 25 A 29 AÑOS"~ "25 a 29 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 30 A 64 AÑOS"~ "30 a 64 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 65 AÑOS Y MÁS"~ "65 años y más"))  %>%
  ggplot(aes(x = FECHA, y = VALOR, color = UNIDAD)) +
  geom_line(aes(group = 5, color = UNIDAD))+
  scale_color_manual(
      values = c(639,"#a1dd70","orangered","lightslategrey","mediumblue")) +
  ylim(0, 100) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

  
#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 14 A 18 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 19 A 24 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 25 A 29 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 30 A 64 AÑOS"|NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 65 AÑOS Y MÁS", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(TRAMO = case_when(NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 14 A 18 AÑOS"~ "14 a 18 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 19 A 24 AÑOS"~ "19 a 24 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 25 A 29 AÑOS"~ "25 a 29 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 30 A 64 AÑOS"~ "30 a 64 años", NOMINDICADOR == "TASA DE ACTIVIDAD DE PERSONAS DE 65 AÑOS Y MÁS"~ "65 años y más"))  %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","TRAMO","ANIO","VALOR")]
t1 <- t1[order(t1$TRAMO,t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                           buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [2,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [2,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Población económicamente activa

sem1 <- sem1 %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 | 
                                              POBPCOAC==3 | 
                                              POBPCOAC==4 | 
                                              POBPCOAC==5, 1, 0))
sem2_panel <- sem2_panel %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 |
                                                          POBPCOAC==3 | 
                                                          POBPCOAC==4 | 
                                                          POBPCOAC==5, 1, 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de actividad según tramo de edad 

a_edad <- function(x) {
  x <- sem1_svy %>%
    filter(tramo_edad == x & E27>=14 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(pea, na.rm=T))
  x <- mean(x$colname)
}       

a_e_edad <- numeric()

for(i in 1:5){
  a_e_edad[i] <- a_edad(x = i)
}     

b_edad <- function(x) {
  x <- sem2_panel_svy %>%
    filter(tramo_edad == x & e27>=14 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(pea, na.rm=T))
  x <- mean(x$colname)
}       

b_e_edad <- numeric()

for(i in 1:5){
  b_e_edad[i] <- b_edad(x = i)
} 

c_edad_pu <- as.data.frame(cbind(a_e_edad, b_e_edad))
c_edad_pu <- c_edad_pu %>% dplyr::mutate(VALOR = (a_e_edad + b_e_edad)/2)
c_edad_pu <- c_edad_pu %>% dplyr::mutate(aux = c(11, 12, 13, 14, 15))
c_edad_pu <- c_edad_pu[,c("VALOR", "aux")]


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [2,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />
<br />

## **Empleo** 


<div style="text-align: justify">
La tasa de empleo da cuenta de la proporción de personas ocupadas sobre el total de personas en edad de trabajar.

Las personas ocupadas son todas aquellas personas en edad de trabajar que, durante la semana anterior a la aplicación de la encuesta, se dedicaban a alguna actividad para producir bienes o prestar servicios a cambio de remuneración o beneficios, ya sea que estuvieran «trabajando» en un puesto de trabajo por lo menos una hora, o «sin trabajar» debido a una ausencia temporal del puesto de trabajo o debido a disposiciones sobre el ordenamiento del tiempo de trabajo (como trabajo en turnos, horarios flexibles y licencias compensatorias por horas extraordinarias).

Considerando las últimas tres décadas, se observa que la tasa de empleo permanece relativamente estable entre 1990 y 1997, disminuye  entre 1998 y 2003 y crece de forma significativa entre 2004 y 2014, año a partir del cual el crecimiento se estanca y decrece levemente.

Al igual que para la tasa de actividad, la brecha según sexo de la tasa de empleo disminuye sustantcialmente, pasando de 29,4 puntos porcentuales en 1990 a 13,1 en 2021.    
</div>

<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE EMPLEO",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de empleo**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE EMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="TASA DE EMPLEO" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
  ) +
  ylim(0, 100) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE EMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [3,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [3,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###

# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))



# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de empleo

a_mes <- sem1_svy %>%
  srvyr::filter(E27>=14 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(ocup, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_panel_svy %>%
  srvyr::filter(e27>=14 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(ocup, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [3,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 



<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE EMPLEO",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de empleo, según sexo**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE EMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "VARONES"|SEXO=="MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  SEXO =="VARONES" ~ "Varones", SEXO == "MUJERES" ~ "Mujeres"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 2, color = UNIDAD))+
  scale_color_manual(
    values = c(639, "#a1dd70"),
    labels = c("Varones", "Mujeres")
  ) +
  ylim(0, 100) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE EMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "VARONES"|SEXO == "MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","SEXO","ANIO","VALOR")]
t1 <- t1[order(t1$SEXO, t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [3,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [3,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))



# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de empleo según sexo

a_sexo <- function(x) {
  x <- sem1_svy %>%
    filter(bc_pe2 == x & E27>=14 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(ocup, na.rm=T))
  x <- mean(x$colname)
}       

a_e_sexo <- numeric()

for(i in 1:2){
  a_e_sexo[i] <- a_sexo(x = i)
}     

b_sexo <- function(x) {
  x <- sem2_panel_svy %>%
    filter(bc_pe2 == x & e27>=14 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(ocup, na.rm=T))
  x <- mean(x$colname)
}       

b_e_sexo <- numeric()

for(i in 1:2){
  b_e_sexo[i] <- b_sexo(x = i)
}     


c_sexo_pu <- as.data.frame(cbind(a_e_sexo, b_e_sexo))
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(VALOR = (a_e_sexo + b_e_sexo)/2)
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(aux = c(9, 10))
c_sexo_pu <- c_sexo_pu[,c("VALOR", "aux")]



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [3,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 



<br />
<br />

## **Desempleo** 



<div style="text-align: justify">
La tasa de desempleo mide el nivel de desocupación entre las personas activas. Este indicador presenta un leve aumento entre 1993 y 1996 y un aumento importante desde 1998 hasta el año 2003, cuando alcanza un valor máximo de 17% en el país urbano. Desde el año 2004 decrece significativamente hasta el año 2014 en que comienza a aumentar. 

Esta tendencia es similar para varones y mujeres, si bien la tasa de desempleo es siempre mayor para las mujeres. Sin embargo, puede verse que  el aumento de la tasa de desempleo entre 1998 y 2003 es más pronunciado para las mujeres, ampliándose la brecha. A partir del año 2010 la brecha comienza a disminuir.   
</div>

<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE DESEMPLEO",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de desempleo** 
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE DESEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="TASA DE DESEMPLEO" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  ylim(0, 30) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE DESEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [4,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [4,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Población económicamente activa

sem1 <- sem1 %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 | 
                                              POBPCOAC==3 | 
                                              POBPCOAC==4 | 
                                              POBPCOAC==5, 1, 0))
sem2_panel <- sem2_panel %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 | 
                                                          POBPCOAC==3 | 
                                                          POBPCOAC==4 | 
                                                          POBPCOAC==5, 1, 0))


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))

# Desempleados

sem1 <- sem1 %>% dplyr::mutate(desocup = ifelse(POBPCOAC==3 | 
                                                  POBPCOAC==4 | 
                                                  POBPCOAC==5, 1, 0))
sem2_panel <- sem2_panel %>% dplyr::mutate(desocup = ifelse(POBPCOAC==3 | 
                                                              POBPCOAC==4 | 
                                                              POBPCOAC==5, 1, 0))

# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de desempleo

a_mes <- sem1_svy %>%
  srvyr::filter(pea == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(desocup, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_panel_svy %>%
  srvyr::filter(pea == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(desocup, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [4,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE DESEMPLEO",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de desempleo, según sexo**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE DESEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "VARONES"|SEXO=="MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  SEXO =="VARONES" ~ "Varones", SEXO == "MUJERES" ~ "Mujeres"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 2, color = UNIDAD))+
  scale_color_manual(
    values = c(639, "#a1dd70"),
    labels = c("Varones", "Mujeres")
  ) +
  ylim(0, 30) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE DESEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "VARONES"|SEXO == "MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","SEXO","ANIO","VALOR")]
t1 <- t1[order(t1$SEXO, t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [4,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [4,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Población económicamente activa

sem1 <- sem1 %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 | 
                                              POBPCOAC==3 | 
                                              POBPCOAC==4 | 
                                              POBPCOAC==5, 1, 0))
sem2_panel <- sem2_panel %>% dplyr::mutate(pea = ifelse(POBPCOAC==2 | 
                                                          POBPCOAC==3 | 
                                                          POBPCOAC==4 | 
                                                          POBPCOAC==5, 1, 0))


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))

# Desempleados

sem1 <- sem1 %>% dplyr::mutate(desocup = ifelse(POBPCOAC==3 | 
                                                  POBPCOAC==4 | 
                                                  POBPCOAC==5, 1, 0))
sem2_panel <- sem2_panel %>% dplyr::mutate(desocup = ifelse(POBPCOAC==3 | 
                                                              POBPCOAC==4 | 
                                                              POBPCOAC==5, 1, 0))

# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de desempleo según sexo

a_sexo <- function(x) {
  x <- sem1_svy %>%
    filter(bc_pe2 == x & pea == 1 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(desocup, na.rm=T))
  x <- mean(x$colname)
}       

a_e_sexo <- numeric()

for(i in 1:2){
  a_e_sexo[i] <- a_sexo(x = i)
}     

b_sexo <- function(x) {
  x <- sem2_panel_svy %>%
    filter(bc_pe2 == x & pea == 1 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(desocup, na.rm=T))
  x <- mean(x$colname)
}       

b_e_sexo <- numeric()

for(i in 1:2){
  b_e_sexo[i] <- b_sexo(x = i)
}     


c_sexo_pu <- as.data.frame(cbind(a_e_sexo, b_e_sexo))
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(VALOR = (a_e_sexo + b_e_sexo)/2)
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(aux = c(9, 10))
c_sexo_pu <- c_sexo_pu[,c("VALOR", "aux")]


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```


## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [4,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 




<br />
<br />



## **Calidad del empleo** 

<div style="text-align: justify">
La tasa de subempleo representa la cantidad de personas ocupadas que trabajan menos de 40 horas semanales, que querrían y pueden trabajar más horas a la semana. Este indicador presenta un leve aumento entre 1993 y 1996 y un aumento importante desde 1998 hasta el año 2003. Desde el año 2004 decrece significativamente hasta el año 2014. 

Este indicador es mayor para las mujeres que para los varones en todo el período y presenta una tendencia similar para ambos. Si bien la brecha en la tasa de subempleo de varones y mujeres disminuye de forma continua desde finales de los 90, en 2016 tiene una caída sustancial, permaneciendo en el entorno de 10% hasta 2021.    
</div>

<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE SUBEMPLEO",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de subempleo**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE SUBEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="TASA DE SUBEMPLEO" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  ylim(0, 30) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE SUBEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [5,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [5,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# Subempleo

sem1 <- sem1 %>% 
  dplyr::mutate(bc_subocupado = ifelse(F102 == 1 & 
                                         F104 == 5 & 
                                         bc_horas > 0 & 
                                         bc_horas < 40, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(bc_subocupado = ifelse(f102 == 1 & 
                                         f104 == 5 & 
                                         bc_horas > 0 & bc_horas < 40, 1, 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de subempleo

a_mes <- sem1_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(bc_subocupado, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_panel_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(bc_subocupado, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [5,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "TASA DE SUBEMPLEO",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Tasa de subempleo, según sexo**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "TASA DE SUBEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "VARONES"|SEXO=="MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  SEXO =="VARONES" ~ "Varones", SEXO == "MUJERES" ~ "Mujeres"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 2, color = UNIDAD))+
  scale_color_manual(
    values = c(639, "#a1dd70"),
    labels = c("Varones", "Mujeres")
  ) +
  ylim(0, 30) +
  scale_x_continuous(breaks=seq(1990, 2020, 5)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="TASA DE SUBEMPLEO", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "VARONES"|SEXO == "MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100, 1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","SEXO","ANIO","VALOR")]
t1 <- t1[order(t1$SEXO, t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [5,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [5,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`

```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# Subempleo

sem1 <- sem1 %>% 
  dplyr::mutate(bc_subocupado = ifelse(F102 == 1 & 
                                         F104 == 5 & 
                                         bc_horas > 0 & 
                                         bc_horas < 40, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(bc_subocupado = ifelse(f102 == 1 & 
                                         f104 == 5 & 
                                         bc_horas > 0 & bc_horas < 40, 1, 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Tasa de subempleo según sexo

a_sexo <- function(x) {
  x <- sem1_svy %>%
    filter(bc_pe2 == x & ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(bc_subocupado, na.rm=T))
  x <- mean(x$colname)
}       

a_e_sexo <- numeric()

for(i in 1:2){
  a_e_sexo[i] <- a_sexo(x = i)
}     

b_sexo <- function(x) {
  x <- sem2_panel_svy %>%
    filter(bc_pe2 == x & ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(bc_subocupado, na.rm=T))
  x <- mean(x$colname)
}       

b_e_sexo <- numeric()

for(i in 1:2){
  b_e_sexo[i] <- b_sexo(x = i)
}     


c_sexo_pu <- as.data.frame(cbind(a_e_sexo, b_e_sexo))
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(VALOR = (a_e_sexo + b_e_sexo)/2)
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(aux = c(9, 10))
c_sexo_pu <- c_sexo_pu[,c("VALOR", "aux")]



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [5,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />
<br />


<div style="text-align: justify">
El porcentaje de personas ocupadas que no aportan a la seguridad social es un indicador de informalidad y de falta de garantías sociales y ejercicio de derechos laborales por parte de esta población. El mismo presenta un descenso constante desde el año 2004 hasta el año 2014, año en que la proporción tiende a estabilizarse.

Este porcentaje es levemente mayor para las mujeres que para los varones entre 2004 y 2012, año a partir del cual esta relación se invierte. 
</div>

<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE OCUPADOS NO REGISTRADOS EN SEGURIDAD SOCIAL EN OCUPACIÓN PRINCIPAL",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas ocupadas que no están registradas en la seguridad social en la ocupación principal** 
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE OCUPADOS NO REGISTRADOS EN SEGURIDAD SOCIAL EN OCUPACIÓN PRINCIPAL", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round((1-as.numeric(VALOR))*100,1)) %>%   mutate(UNIDAD = case_when(
  NOMINDICADOR =="PORCENTAJE DE OCUPADOS NO REGISTRADOS EN SEGURIDAD SOCIAL EN OCUPACIÓN PRINCIPAL" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  ylim(0, 50) +
  scale_x_continuous(breaks=seq(2000, 2021, 2), limits=c(2000,2021))  +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

 



#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE OCUPADOS NO REGISTRADOS EN SEGURIDAD SOCIAL EN OCUPACIÓN PRINCIPAL", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0) %>%
  mutate(VALOR = round((1-as.numeric(VALOR))*100,1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [6,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [6,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# No aporte a SS en trabajo principal y secundario

sem1 <- sem1 %>% dplyr::mutate(bc_register2 = ifelse(F96 == 1 | F82 == 1, 0, 1))
sem2_implant <- sem2_implant %>% dplyr::mutate(bc_register2 = ifelse(f96 == 1 | f82 == 1, 0, 1))
sem2_panel <- sem2_panel %>% dplyr::mutate(bc_register2 = ifelse(f96 == 1 | f82 == 1, 0, 1))


# No aporte a SS en trabajo principal

sem1 <- sem1 %>% dplyr::mutate(bc_register = ifelse(F82 == 1, 0, 1))
sem2_implant <- sem2_implant %>% dplyr::mutate(bc_register = ifelse(f82 == 1, 0, 1))
sem2_panel <- sem2_panel %>% dplyr::mutate(bc_register = ifelse(f82 == 1, 0, 1))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de ocupados que no aportan a la seguridad social en ocupación principal

a_mes <- sem1_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(bc_register, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_panel_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(bc_register, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [6,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />


<div style="text-align: center">

```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE OCUPADOS NO REGISTRADOS EN SEGURIDAD SOCIAL EN OCUPACIÓN PRINCIPAL",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas ocupadas que no están registradas en la seguridad social en la ocupación principal, según sexo**
##### País Urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE OCUPADOS NO REGISTRADOS EN SEGURIDAD SOCIAL EN OCUPACIÓN PRINCIPAL", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", SEXO == "VARONES"|SEXO=="MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round((1-as.numeric(VALOR))*100,1)) %>% 
  mutate(UNIDAD = case_when(
  SEXO =="VARONES" ~ "Varones", SEXO == "MUJERES" ~ "Mujeres"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 2, color = UNIDAD))+
  scale_color_manual(
    values = c(639, "#a1dd70"),
    labels = c("Varones", "Mujeres")
  ) +
  ylim(0, 50) +
  scale_x_continuous(breaks=seq(2000, 2021, 2), limits=c(2000,2021))  +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE OCUPADOS NO REGISTRADOS EN SEGURIDAD SOCIAL EN OCUPACIÓN PRINCIPAL", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "VARONES"|SEXO == "MUJERES", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round((1-as.numeric(VALOR))*100,1)) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","SEXO","ANIO","VALOR")]
t1 <- t1[order(t1$SEXO, t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [6,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [6,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# No aporte a SS en trabajo principal y secundario

sem1 <- sem1 %>% dplyr::mutate(bc_register2 = ifelse(F96 == 1 | F82 == 1, 0, 1))
sem2_implant <- sem2_implant %>% dplyr::mutate(bc_register2 = ifelse(f96 == 1 | f82 == 1, 0, 1))
sem2_panel <- sem2_panel %>% dplyr::mutate(bc_register2 = ifelse(f96 == 1 | f82 == 1, 0, 1))


# No aporte a SS en trabajo principal

sem1 <- sem1 %>% dplyr::mutate(bc_register = ifelse(F82 == 1, 0, 1))
sem2_implant <- sem2_implant %>% dplyr::mutate(bc_register = ifelse(f82 == 1, 0, 1))
sem2_panel <- sem2_panel %>% dplyr::mutate(bc_register = ifelse(f82 == 1, 0, 1))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de ocupados que no aportan a la seguridad social en ocupación principal según sexo

a_sexo <- function(x) {
  x <- sem1_svy %>%
    filter(bc_pe2 == x & ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(bc_register, na.rm=T))
  x <- mean(x$colname)
}       

a_e_sexo <- numeric()

for(i in 1:2){
  a_e_sexo[i] <- a_sexo(x = i)
}     

b_sexo <- function(x) {
  x <- sem2_panel_svy %>%
    filter(bc_pe2 == x & ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
    srvyr::group_by(mes) %>%
    srvyr::summarise(colname = srvyr::survey_mean(bc_register, na.rm=T))
  x <- mean(x$colname)
}       

b_e_sexo <- numeric()

for(i in 1:2){
  b_e_sexo[i] <- b_sexo(x = i)
}     


c_sexo_pu <- as.data.frame(cbind(a_e_sexo, b_e_sexo))
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(VALOR = (a_e_sexo + b_e_sexo)/2)
c_sexo_pu <- c_sexo_pu %>% dplyr::mutate(aux = c(9, 10))
c_sexo_pu <- c_sexo_pu[,c("VALOR", "aux")]


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [6,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 



<br />


<div style="text-align: center">

<div style="text-align: justify">
El porcentaje de personas ocupadas sin restricciones en el empleo (se considera subempleo y no aporte a la seguridad social) aumenta entre 2006 y 2021. Esta disminución tiene como correlato, principalmente, una disminución del porcentaje de personas que no aportan a la seguridad social.
</div>


```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE PERSONAS OCUPADAS SIN RESTRICCIONES AL EMPLEO"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS SUBEMPLEADAS"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS Y SUBEMPLEADAS"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Distribución de personas ocupadas según restricciones en el empleo**
##### Total país, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(base$NOMINDICADOR == "PORCENTAJE DE PERSONAS OCUPADAS SIN RESTRICCIONES AL EMPLEO"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS SUBEMPLEADAS"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS Y SUBEMPLEADAS"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS", URBANORURALUY == "TOTAL PAÍS", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR == "PORCENTAJE DE PERSONAS OCUPADAS SIN RESTRICCIONES AL EMPLEO"~"Sin restricciones",NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS SUBEMPLEADAS"~"Subempleo",NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS Y SUBEMPLEADAS"~"Subempleo y no registro", NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS"~"No registro"))  %>%
    mutate(UNIDAD = factor(UNIDAD, levels = c("Subempleo y no registro", "Subempleo", "No registro","Sin restricciones")))  %>%
  ggplot(aes(x = FECHA, y = VALOR, fill=UNIDAD)) +
  geom_bar(stat="identity", width=0.6)+
  scale_fill_manual(
    values = c("darkorange", "grey60",639,"#a1dd70"),
  ) +
#  ylim(0, 100) +
  guides(fill = guide_legend(title = ""))+
  scale_x_continuous(breaks=seq(2006, 2021, 1)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% filter(base$NOMINDICADOR == "PORCENTAJE DE PERSONAS OCUPADAS SIN RESTRICCIONES AL EMPLEO"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS SUBEMPLEADAS"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS Y SUBEMPLEADAS"|base$NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS", URBANORURALUY == "TOTAL PAÍS", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS") %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR == "PORCENTAJE DE PERSONAS OCUPADAS SIN RESTRICCIONES AL EMPLEO"~"Sin restricciones",NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS SUBEMPLEADAS"~"Subempleo",NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS Y SUBEMPLEADAS"~"Subempleo y no registro", NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS"~"No registro"))  %>%
  mutate(NOMINDICADOR = case_when(
  NOMINDICADOR == "PORCENTAJE DE PERSONAS OCUPADAS SIN RESTRICCIONES AL EMPLEO"~"DISTRIBUCIÓN DE PERSONAS SEGÚN RESTRICCIONES EN EL EMPLEO",NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS SUBEMPLEADAS"~"DISTRIBUCIÓN DE PERSONAS SEGÚN RESTRICCIONES EN EL EMPLEO",NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS Y SUBEMPLEADAS"~"DISTRIBUCIÓN DE PERSONAS SEGÚN RESTRICCIONES EN EL EMPLEO",NOMINDICADOR=="PORCENTAJE DE PERSONAS OCUPADAS NO REGISTRADAS"~"DISTRIBUCIÓN DE PERSONAS SEGÚN RESTRICCIONES EN EL EMPLEO"))  %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","UNIDAD","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO, t1$UNIDAD), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [11,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [11,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# No aporte a SS en trabajo principal y secundario

sem1 <- sem1 %>% 
  dplyr::mutate(bc_register2 = ifelse(F96 == 1 | F82 == 1, 0, 1))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bc_register2 = ifelse(f96 == 1 | f82 == 1, 0, 1))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(bc_register2 = ifelse(f96 == 1 | f82 == 1, 0, 1))


# No aporte a SS en trabajo principal

sem1 <- sem1 %>% 
  dplyr::mutate(bc_register = ifelse(F82 == 1, 0, 1))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bc_register = ifelse(f82 == 1, 0, 1))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(bc_register = ifelse(f82 == 1, 0, 1))



# Subempleo

sem1 <- sem1 %>% 
  dplyr::mutate(bc_subocupado = ifelse(F102 == 1 & 
                                        F104 == 5 & 
                                        bc_horas > 0 & 
                                        bc_horas < 40, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(bc_subocupado = ifelse(f102 == 1 & 
                                       f104 == 5 & 
                                       bc_horas > 0 & 
                                       bc_horas < 40, 1, 0))


# Restricciones al empleo

sem1 <- sem1 %>% 
  dplyr::mutate(nre = ifelse(bc_register2 == 1 & bc_subocupado == 0 , 1, 0))
sem1 <- sem1 %>% 
  dplyr::mutate(sub = ifelse(bc_register2 == 0 & bc_subocupado == 1 , 1, 0))
sem1 <- sem1 %>% 
  dplyr::mutate(amb = ifelse(bc_register2 == 1 & bc_subocupado == 1 , 1, 0))
sem1 <- sem1 %>% 
  dplyr::mutate(sin = ifelse(bc_register2 == 0 & bc_subocupado == 0 , 1, 0))

sem2_panel <- sem2_panel %>% 
  dplyr::mutate(nre = ifelse(bc_register2 == 1 & bc_subocupado == 0 , 1, 0))
sem2_panel <- sem2_panel %>%
  dplyr::mutate(sub = ifelse(bc_register2 == 0 & bc_subocupado == 1 , 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(amb = ifelse(bc_register2 == 1 & bc_subocupado == 1 , 1, 0))
sem2_panel <- sem2_panel %>%
  dplyr::mutate(sin = ifelse(bc_register2 == 0 & bc_subocupado == 0 , 1, 0))

restricciones <- c("nre", "sub", "amb", "sin")



# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Distribución de personas ocupadas según restricciones al empleo

Restricciones <- c("No registradas",
                   "Subempleadas",
                   "No registradas y subempleadas",
                   "Sin restricciones al empleo")
  
# Total

base <- sem1_svy2 %>% filter(ocup == 1)

a_sem <- sapply(base$variables %>% select(restricciones), function(x){
  base %>%
    filter(ocup == 1) %>%
    srvyr::summarise(VALOR_1 = srvyr::survey_mean(x, na.rm = TRUE)) 
})

a_sem <- data.frame(t(a_sem))

base <- sem2_panel_svy %>% filter(ocup == 1)

b_sem <- sapply(base$variables %>% select(restricciones), function(x){
  base %>%
    srvyr::summarise(VALOR_2 = srvyr::survey_mean(x, na.rm = TRUE)) 
})

b_sem <- data.frame(t(b_sem))

c_ano <- cbind(a_sem, b_sem)
c_ano <- c_ano %>% dplyr::mutate(VALOR = (as.numeric(VALOR_1) + as.numeric(VALOR_2)) /2)
c_ano <- c_ano %>% dplyr::mutate(aux = 1)
c_ano <- c_ano %>% dplyr::mutate(RESTRICCIONES_AL_EMPLEO = Restricciones)
c_ano <- c_ano[,c("VALOR", "aux", "RESTRICCIONES_AL_EMPLEO")]


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [11,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />
<br />

# **Nivel y suficiencia de ingresos laborales** 

## **Nivel de ingresos laborales** 

<div style="text-align: justify">

El siguiente indicador presenta el promedio de ingresos que reciben las personas ocupadas por hora de trabajo en su ocupación princial. El mismo se encuentra deflactado a precios de diciembre del año 2006 por lo cual habilita dar cuenta de la evolución real durante el período. Desde 2001 a 2003, el indicador presenta una caída y a partir del año 2004 presenta una tendencia creciente en el país urbano. A partir de 2020 se observa una caída del promedio de ingresos laborales por hora de trabajo luego de 16 años.  										
</div>

<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "INGRESO POR HORA PROMEDIO EN OCUPACIÓN PRINCIPAL (DEF. BASE 2010)",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Salario promedio por hora de trabajo remunerado en ocupación principal (cte. base diciembre 2006)**
##### País urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "INGRESO POR HORA PROMEDIO EN OCUPACIÓN PRINCIPAL (DEF. BASE 2010)", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", edad == 0, pobr == 0) %>%
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="INGRESO POR HORA PROMEDIO EN OCUPACIÓN PRINCIPAL (DEF. BASE 2010)" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  scale_x_continuous(breaks=seq(2000, 2021, 2), limits=c(2000,2021))  +
  ylim (0,120) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="INGRESO POR HORA PROMEDIO EN OCUPACIÓN PRINCIPAL (DEF. BASE 2010)", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0, pobr == 0) %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [12,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [12,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###

#IPC

sem1 <- sem1 %>% dplyr::mutate(bc_ipc_tot = case_when(mes == 1 ~ 0.335542051,
                                                      mes == 2 ~ 0.330249262,
                                                      mes == 3 ~ 0.327549795,
                                                      mes == 4 ~ 0.32554687,
                                                      mes == 5 ~ 0.323919843,
                                                      mes == 6 ~ 0.322448435))

sem2_implant <- sem2_implant %>% dplyr::mutate(bc_ipc_tot = case_when(
  mes == 7  ~ 0.320314392,
  mes == 8  ~ 0.318657357,
  mes == 9  ~ 0.31596912,
  mes == 10 ~ 0.314515807,
  mes == 11 ~ 0.31128448,
  mes == 12 ~ 0.310493463))


sem1 <- sem1 %>% dplyr::mutate(bc_ipc = case_when(    mes == 1 ~ 0.329708731,
                                                      mes == 2 ~ 0.325120854,
                                                      mes == 3 ~ 0.32193312,
                                                      mes == 4 ~ 0.320163041,
                                                      mes == 5 ~ 0.318357918,
                                                      mes == 6 ~ 0.316774856))

sem2_implant <- sem2_implant %>% dplyr::mutate(bc_ipc = case_when(
  mes == 7 ~  0.314794762,
  mes == 8 ~  0.31306265,
  mes == 9 ~  0.310558149,
  mes == 10 ~ 0.309320866,
  mes == 11 ~ 0.306270364,
  mes == 12 ~ 0.305191859))                                                 


sem1 <- sem1 %>% dplyr::mutate(ipc_ene2022 = case_when(    mes == 1 ~ 0.941120053,
                                                           mes == 2 ~ 0.948876194,
                                                           mes == 3 ~ 0.32193312,
                                                           mes == 4 ~ 0.959509612,
                                                           mes == 5 ~ 0.963888078,
                                                           mes == 6 ~ 0.970309829))

sem2_implant <- sem2_implant %>% dplyr::mutate(ipc_ene2022 = case_when(
  mes == 7 ~  0.97535549,
  mes == 8 ~  0.983653726,
  mes == 9 ~  0.988198991,
  mes == 10 ~ 0.998457112,
  mes == 11 ~ 1.001000792,
  mes == 12 ~ 1))                                                 

sem2_panel <- sem2_panel %>% dplyr::mutate(ipc_ene2022 = case_when(
  mes == 7 ~  0.97535549,
  mes == 8 ~  0.983653726,
  mes == 9 ~  0.988198991,
  mes == 10 ~ 0.998457112,
  mes == 11 ~ 1.001000792,
  mes == 12 ~ 1))   

# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# Salario en ocupación principal

sem1 <- sem1 %>% 
  dplyr::mutate(horamen = F85 * 4.3)
sem1 <- sem1 %>% 
  dplyr::mutate(yhora = PT2/horamen)
sem1 <- sem1 %>% 
  dplyr::mutate(yhoradef = case_when(F85>0 ~ yhora*bc_ipc_tot,
                                                    F85==0 ~ 0))
                               
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(horamen = f85 * 4.3)
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(yhora = pt2/horamen)
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(yhoradef = case_when(f85>0 ~ yhora*bc_ipc_tot,
                                                                    f85==0 ~ 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Salario promedio por hora de trabajo remunerado en ocupación principal

a_mes <- sem1_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2) & F85>0) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(yhoradef, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_implant_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2) & f85>0) %>%
  srvyr::summarise(colname = srvyr::survey_mean(yhoradef, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [12,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 



<br />

## **Suficiencia de ingresos** 

<div style="text-align: justify">
Los siguientes gráficos son indicativos de la suficiencia de ingresos laborales de las personas ocupadas. El primer inicador muestra el porcentaje de ocupados cuyos ingresos mensuales se encuentran por debajo del salario mínimo nacional de enero de 2019. El segundo indicador da cuenta de la poroporción de esta población cuyos ingresos se encuentran por debajo de la línea de pobreza individual (definida para la población que reside en hogares unipersonales). Ambos indicadores presentan un importante descenso en el período, dando cuenta de un aumento de la suficiencia de los ingresos percibidos por la población empleada.
</div>

<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE OCUPADOS QUE PERCIBEN UN INGRESO POR DEBAJO DEL SMN",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas ocupadas que perciben ingresos por debajo del salario mínimo nacional**
##### País urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE OCUPADOS QUE PERCIBEN UN INGRESO POR DEBAJO DEL SMN", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="PORCENTAJE DE OCUPADOS QUE PERCIBEN UN INGRESO POR DEBAJO DEL SMN" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  ylim(0,60) +
  scale_x_continuous(breaks=seq(2000, 2021, 2), limits=c(2000,2021))  +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE OCUPADOS QUE PERCIBEN UN INGRESO POR DEBAJO DEL SMN", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS" , edad == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [13,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [13,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###

smn <- 17930
smn_h = smn/200

sem1 <- sem1 %>% dplyr::mutate(bc_ipc_tot = case_when(mes == 1 ~ 0.335542051,
                                                      mes == 2 ~ 0.330249262,
                                                      mes == 3 ~ 0.327549795,
                                                      mes == 4 ~ 0.32554687,
                                                      mes == 5 ~ 0.323919843,
                                                      mes == 6 ~ 0.322448435))

sem2_implant <- sem2_implant %>% dplyr::mutate(bc_ipc_tot = case_when(
  mes == 7  ~ 0.320314392,
  mes == 8  ~ 0.318657357,
  mes == 9  ~ 0.31596912,
  mes == 10 ~ 0.314515807,
  mes == 11 ~ 0.31128448,
  mes == 12 ~ 0.310493463))


sem1 <- sem1 %>% dplyr::mutate(bc_ipc = case_when(    mes == 1 ~ 0.329708731,
                                                      mes == 2 ~ 0.325120854,
                                                      mes == 3 ~ 0.32193312,
                                                      mes == 4 ~ 0.320163041,
                                                      mes == 5 ~ 0.318357918,
                                                      mes == 6 ~ 0.316774856))

sem2_implant <- sem2_implant %>% dplyr::mutate(bc_ipc = case_when(
  mes == 7 ~  0.314794762,
  mes == 8 ~  0.31306265,
  mes == 9 ~  0.310558149,
  mes == 10 ~ 0.309320866,
  mes == 11 ~ 0.306270364,
  mes == 12 ~ 0.305191859))                                                 


sem1 <- sem1 %>% dplyr::mutate(ipc_ene2022 = case_when(    mes == 1 ~ 0.941120053,
                                                           mes == 2 ~ 0.948876194,
                                                           mes == 3 ~ 0.32193312,
                                                           mes == 4 ~ 0.959509612,
                                                           mes == 5 ~ 0.963888078,
                                                           mes == 6 ~ 0.970309829))

sem2_implant <- sem2_implant %>% dplyr::mutate(ipc_ene2022 = case_when(
  mes == 7 ~  0.97535549,
  mes == 8 ~  0.983653726,
  mes == 9 ~  0.988198991,
  mes == 10 ~ 0.998457112,
  mes == 11 ~ 1.001000792,
  mes == 12 ~ 1))                                                 

sem2_panel <- sem2_panel %>% dplyr::mutate(ipc_ene2022 = case_when(
  mes == 7 ~  0.97535549,
  mes == 8 ~  0.983653726,
  mes == 9 ~  0.988198991,
  mes == 10 ~ 0.998457112,
  mes == 11 ~ 1.001000792,
  mes == 12 ~ 1))   

# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# Salario en ocupación principal

sem1 <- sem1 %>% 
  dplyr::mutate(horamen = F85 * 4.3)
sem1 <- sem1 %>% 
  dplyr::mutate(yhora = PT2/horamen)
sem1 <- sem1 %>% 
  dplyr::mutate(yhoradef = case_when(F85>0 ~ yhora*bc_ipc_tot,
                                                    F85==0 ~ 0))
                               
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(horamen = f85 * 4.3)
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(yhora = pt2/horamen)
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(yhoradef = case_when(f85>0 ~ yhora*bc_ipc_tot,
                                     f85==0 ~ 0))

# Salario por debajo del salario mínimo nacional

sem1 <- sem1 %>% 
  dplyr::mutate(salario_insuf_smn = ifelse(yhora<smn_h, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(salario_insuf_smn = ifelse(yhora<smn_h, 1, 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de personas ocupadas que perciben ingresos por debajo del salario mínimo nacional

a_mes <- sem1_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(salario_insuf_smn, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_implant_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::summarise(colname = srvyr::survey_mean(salario_insuf_smn, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [13,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 

<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE OCUPADOS QUE PERCIBEN UN INGRESO POR DEBAJO DE LA LÍNEA DE POBREZA",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas ocupadas que perciben ingresos por debajo de la línea de pobreza**
##### Total país, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE OCUPADOS QUE PERCIBEN UN INGRESO POR DEBAJO DE LA LÍNEA DE POBREZA", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"|URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"|URBANORURALUY == "RURAL DISPERSO"|URBANORURALUY == "TOTAL PAÍS", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"~"Urbano (Menos de 5.000 habitantes)", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"~"Urbano (Más de 5.000 habitantes)",URBANORURALUY == "RURAL DISPERSO"~ "Rural disperso", URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
  mutate(UNIDAD = factor(UNIDAD, levels = c("Urbano (Menos de 5.000 habitantes)", "Urbano (Más de 5.000 habitantes)", "Rural disperso", "Total país")))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 4, color = UNIDAD))+
 scale_color_manual(
    values = c(639, "#a1dd70","orangered","lightslategrey"),
      ) +
  ylim(0, 75) +
  scale_x_continuous(breaks=seq(2006, 2021, 2)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE OCUPADOS QUE PERCIBEN UN INGRESO POR DEBAJO DE LA LÍNEA DE POBREZA", URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"|URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"|URBANORURALUY == "RURAL DISPERSO"|URBANORURALUY == "TOTAL PAÍS", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS" , edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"~"Urbano (Menos de 5.000 habitantes)", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"~"Urbano (Más de 5.000 habitantes)",URBANORURALUY == "RURAL DISPERSO"~ "Rural disperso", URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
    mutate(UNIDAD = factor(UNIDAD, levels = c("Urbano (Menos de 5.000 habitantes)", "Urbano (Más de 5.000 habitantes)", "Rural disperso", "Total país")))  %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO, t1$UNIDAD_GEOGRÁFICA), ]

DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [14,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [14,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###

smn <- 17930
smn_h = smn/200

sem1 <- sem1 %>% dplyr::mutate(bc_ipc_tot = case_when(mes == 1 ~ 0.335542051,
                                                      mes == 2 ~ 0.330249262,
                                                      mes == 3 ~ 0.327549795,
                                                      mes == 4 ~ 0.32554687,
                                                      mes == 5 ~ 0.323919843,
                                                      mes == 6 ~ 0.322448435))

sem2_implant <- sem2_implant %>% dplyr::mutate(bc_ipc_tot = case_when(
  mes == 7  ~ 0.320314392,
  mes == 8  ~ 0.318657357,
  mes == 9  ~ 0.31596912,
  mes == 10 ~ 0.314515807,
  mes == 11 ~ 0.31128448,
  mes == 12 ~ 0.310493463))


sem1 <- sem1 %>% dplyr::mutate(bc_ipc = case_when(    mes == 1 ~ 0.329708731,
                                                      mes == 2 ~ 0.325120854,
                                                      mes == 3 ~ 0.32193312,
                                                      mes == 4 ~ 0.320163041,
                                                      mes == 5 ~ 0.318357918,
                                                      mes == 6 ~ 0.316774856))

sem2_implant <- sem2_implant %>% dplyr::mutate(bc_ipc = case_when(
  mes == 7 ~  0.314794762,
  mes == 8 ~  0.31306265,
  mes == 9 ~  0.310558149,
  mes == 10 ~ 0.309320866,
  mes == 11 ~ 0.306270364,
  mes == 12 ~ 0.305191859))                                                 


sem1 <- sem1 %>% dplyr::mutate(ipc_ene2022 = case_when(    mes == 1 ~ 0.941120053,
                                                           mes == 2 ~ 0.948876194,
                                                           mes == 3 ~ 0.32193312,
                                                           mes == 4 ~ 0.959509612,
                                                           mes == 5 ~ 0.963888078,
                                                           mes == 6 ~ 0.970309829))

sem2_implant <- sem2_implant %>% dplyr::mutate(ipc_ene2022 = case_when(
  mes == 7 ~  0.97535549,
  mes == 8 ~  0.983653726,
  mes == 9 ~  0.988198991,
  mes == 10 ~ 0.998457112,
  mes == 11 ~ 1.001000792,
  mes == 12 ~ 1))                                                 

sem2_panel <- sem2_panel %>% dplyr::mutate(ipc_ene2022 = case_when(
  mes == 7 ~  0.97535549,
  mes == 8 ~  0.983653726,
  mes == 9 ~  0.988198991,
  mes == 10 ~ 0.998457112,
  mes == 11 ~ 1.001000792,
  mes == 12 ~ 1))   

# Ocupados

sem1 <- sem1 %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(ocup = ifelse(pobpcoac==2, 1, 0))
sem2_panel <- sem2_panel %>% 
  dplyr::mutate(ocup = ifelse(POBPCOAC==2, 1, 0))


# Salario en ocupación principal

sem1 <- sem1 %>% 
  dplyr::mutate(horamen = F85 * 4.3)
sem1 <- sem1 %>% 
  dplyr::mutate(yhora = PT2/horamen)
sem1 <- sem1 %>% 
  dplyr::mutate(yhoradef = case_when(F85>0 ~ yhora*bc_ipc_tot,
                                                    F85==0 ~ 0))
                               
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(horamen = f85 * 4.3)
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(yhora = pt2/horamen)
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(yhoradef = case_when(f85>0 ~ yhora*bc_ipc_tot,
                                     f85==0 ~ 0))

# Línea de pobreza individual

sem1 <- sem1 %>% dplyr::mutate(regionlp = case_when(region_4 == 1 ~ 1,
                                                    region_4 == 2 | region_4 == 3 ~ 2,
                                                    region_4 == 4 ~ 3))


sem1 <- sem1 %>% dplyr::mutate(grupolp = case_when(regionlp == 1 & mes == 1 ~ 1,
                                                   regionlp == 1 & mes == 2 ~ 2,
                                                   regionlp == 1 & mes == 3 ~ 3,
                                                   regionlp == 1 & mes == 4 ~ 4,
                                                   regionlp == 1 & mes == 5 ~ 5,
                                                   regionlp == 1 & mes == 6 ~ 6,
                                                   regionlp == 2 & mes == 1 ~ 7,
                                                   regionlp == 2 & mes == 2 ~ 8,
                                                   regionlp == 2 & mes == 3 ~ 9,
                                                   regionlp == 2 & mes == 4 ~ 10,
                                                   regionlp == 2 & mes == 5 ~ 11,
                                                   regionlp == 2 & mes == 6 ~ 12,
                                                   regionlp == 3 & mes == 1 ~ 13,
                                                   regionlp == 3 & mes == 2 ~ 14,
                                                   regionlp == 3 & mes == 3 ~ 15,
                                                   regionlp == 3 & mes == 4 ~ 16,
                                                   regionlp == 3 & mes == 5 ~ 17,
                                                   regionlp == 3 & mes == 6 ~ 18))

sem1_unipersonales <- sem1 %>%  filter(ht19==1)
sem1_unipersonales <- sem1_unipersonales[,c("numero","grupolp", "lp_06")]
sem1_unipersonales <- sem1_unipersonales %>% dplyr::mutate(lp_unipersonales = lp_06)
sem1_unipersonales <- sem1_unipersonales[order(sem1_unipersonales$grupolp, sem1_unipersonales$lp_unipersonales, decreasing = TRUE), ]
sem1_unipersonales <- sem1_unipersonales %>% distinct(grupolp, .keep_all = TRUE)
sem1_unipersonales <- sem1_unipersonales[,c("grupolp","lp_unipersonales")]

sem1 <- merge(sem1, sem1_unipersonales, by = "grupolp")


sem2_implant <- sem2_implant %>% dplyr::mutate(regionlp = case_when(region_4 == 1 ~ 1,
                                                                    region_4 == 2 | region_4 == 3 ~ 2,
                                                                    region_4 == 4 ~ 3))


sem2_implant <- sem2_implant %>% dplyr::mutate(grupolp = case_when(regionlp == 1 & mes == 7 ~ 1,
                                                                   regionlp == 1 & mes == 8 ~ 2,
                                                                   regionlp == 1 & mes == 9 ~ 3,
                                                                   regionlp == 1 & mes == 10 ~ 4,
                                                                   regionlp == 1 & mes == 11 ~ 5,
                                                                   regionlp == 1 & mes == 12 ~ 6,
                                                                   regionlp == 2 & mes == 7 ~ 7,
                                                                   regionlp == 2 & mes == 8 ~ 8,
                                                                   regionlp == 2 & mes == 9 ~ 9,
                                                                   regionlp == 2 & mes == 10 ~ 10,
                                                                   regionlp == 2 & mes == 11 ~ 11,
                                                                   regionlp == 2 & mes == 12 ~ 12,
                                                                   regionlp == 3 & mes == 7 ~ 13,
                                                                   regionlp == 3 & mes == 8 ~ 14,
                                                                   regionlp == 3 & mes == 9 ~ 15,
                                                                   regionlp == 3 & mes == 10 ~ 16,
                                                                   regionlp == 3 & mes == 11 ~ 17,
                                                                   regionlp == 3 & mes == 12 ~ 18))

sem2_implant_unipersonales <- sem2_implant %>%  filter(ht19==1)
sem2_implant_unipersonales <- sem2_implant_unipersonales[,c("grupolp", "lp")]
sem2_implant_unipersonales <- sem2_implant_unipersonales %>% dplyr::mutate(lp_unipersonales = lp)
sem2_implant_unipersonales <- sem2_implant_unipersonales[order(sem2_implant_unipersonales$grupolp, sem2_implant_unipersonales$lp_unipersonales, decreasing = TRUE), ]
sem2_implant_unipersonales <- sem2_implant_unipersonales %>% distinct(grupolp, .keep_all = TRUE)
sem2_implant_unipersonales <- sem2_implant_unipersonales[,c("grupolp","lp_unipersonales")]

sem2_implant <- merge(sem2_implant, sem2_implant_unipersonales, by = "grupolp")



# Salario por debajo de línea de pobreza

sem1 <- sem1 %>% dplyr::mutate(salario_insuf   = ifelse(PT2 < lp_unipersonales, 1, 0))
sem2_implant <- sem2_implant %>% dplyr::mutate(salario_insuf = ifelse(pt2 < lp_unipersonales, 1, 0))

# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de personas ocupadas que perciben ingresos por debajo de la línea de pobreza

a_mes <- sem1_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(salario_insuf, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_implant_svy %>%
  srvyr::filter(ocup == 1 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::summarise(colname = srvyr::survey_mean(salario_insuf, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [14,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 



<br />

## **Poder adquisitivo** 

<div style="text-align: justify">
El índice medio de salarios (IMS) estima los ingresos corrientes de los trabajadores permanentes en relación de dependencia de los sectores público y privado formal de todo el país mientras que el índice de precios al consumo (IPC) es un indicador agregado que estima la variación mensual de los precios de bienes y servicios que consumen los hogares. El ISR, calculado como el cociente entre el IMS y el IPC, permite observar la evolución del poder adquisitivo de los asalariados, por lo que lo convierte en un indicador de referencia para la economía. Aumentos del ISR indican que el poder adquisitivo medio de los asalariados en relación de dependencia aumenta, por lo que en promedio pueden comprar más bienes y servicios que en el período anterior.
</div>

<br />

<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "Índice de salario real anual - Sector Institucional (base 100 = 2008), según INE",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Índice de salario real anual según sector Institucional (base 100 = 2008)**
##### `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "Índice de salario real anual - Sector Institucional (base 100 = 2008), según INE", SECTORINSTITUCIONAL == "Total economía"|SECTORINSTITUCIONAL=="Sector público"|SECTORINSTITUCIONAL=="Sector privado") %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 3, color = SECTORINSTITUCIONAL))+
  scale_color_manual(
    values = c(639, "#a1dd70","orangered"),
      ) +
  ylim(0, 200) +
  scale_x_continuous (breaks=seq(1968, 2021, 4)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR == "Índice de salario real anual - Sector Institucional (base 100 = 2008), según INE", SECTORINSTITUCIONAL =="Total economía"|SECTORINSTITUCIONAL=="Sector público"|SECTORINSTITUCIONAL=="Sector privado") %>%
  rename(ANIO = FECHA) %>%
  rename(SECTOR = SECTORINSTITUCIONAL)

t1 <- t1 [,c("NOMINDICADOR","PAÍS","SECTOR","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO, t1$SECTOR), ]

DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [16,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [16,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [16,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 



<br />

# **Transferencias** 

<br />

## **Cobertura de las transferencias contributivas** 

<div style="text-align: justify">

Los siguientes indicadores presentan el porcentaje de personas mayores de 65 años que perciben jubilaciones y el porcentaje de mayores de 65 años que perciben pensiones. Si bien ambos indicadores tienen una tendencia relativamente estable a lo largo del período, la proporción de mayores que perciben jubilación presenta una leve tendencia al aumento a partir del año 2007. Por su parte, la porporción que percibe pensiones presenta una leve tendencia al descenso a partir de 2010.  										
</div>

<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN JUBILACIÓN",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas mayores de 65 años que perciben jubilación** 
##### País urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN JUBILACIÓN", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN JUBILACIÓN" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  ylim(0, 100) +
  scale_x_continuous(breaks=seq(1992, 2021, 4)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN JUBILACIÓN", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [22,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [22,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###

# Percepción de jubilaciones

sem1 <- sem1 %>% dplyr::mutate(jub = ifelse(G148_1_1 > 0 |
                                              G148_1_2 > 0 |
                                              G148_1_3 > 0 |
                                              G148_1_4 > 0 |
                                              G148_1_5 > 0 |
                                              G148_1_6 > 0 |
                                              G148_1_7 > 0 |
                                              G148_1_8 > 0 |
                                              G148_1_9 > 0 |
                                              G148_1_10 > 0 |
                                              G148_1_11 > 0, 1, 0))

sem2_implant <- sem2_implant %>% dplyr::mutate(jub = ifelse(g148_1_1 > 0 |
                                                              g148_1_2 > 0 |
                                                              g148_1_3 > 0 |
                                                              g148_1_5 > 0 |
                                                              g148_1_6 > 0 |
                                                              g148_1_7 > 0 |
                                                              g148_1_8 > 0 |
                                                              g148_1_9 > 0 |
                                                              g148_1_10 > 0 |
                                                              g148_1_11 > 0, 1, 0)) 


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de mayores de 65 años que perciben jubilación

a_mes <- sem1_svy %>%
  srvyr::filter(tramo_edad == 5 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(jub, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_implant_svy %>%
  srvyr::filter(tramo_edad == 5 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::summarise(colname = srvyr::survey_mean(jub, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [22,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 

<br />

<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN PENSIÓN",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas mayores de 65 años que perciben pensiones**
##### País urbano, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN PENSIÓN", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  NOMINDICADOR =="PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN PENSIÓN" ~ "Urbano (más de 5.000 habitantes)"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 1, color = UNIDAD)) +
  scale_color_manual(
      values = c(639)
    ) +
  ylim(0, 75) +
  scale_x_continuous(breaks=seq(1992, 2021, 4)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE MAYORES DE 65 AÑOS QUE PERCIBEN PENSIÓN", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO), ]


DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [23,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [23,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###

# Percepción de pensiones

sem1 <- sem1 %>% dplyr::mutate(pens = ifelse(G148_2_1 > 0 |
                                               G148_2_2 > 0 |
                                               G148_2_3 > 0 |
                                               G148_2_4 > 0 |
                                               G148_2_5 > 0 |
                                               G148_2_6 > 0 |
                                               G148_2_7 > 0 |
                                               G148_2_8 > 0 |
                                               G148_2_9 > 0 |
                                               G148_2_10 > 0 |
                                               G148_2_11 > 0, 1, 0))

sem2_implant <- sem2_implant %>% dplyr::mutate(pens = ifelse(g148_2_1 > 0 |
                                                               g148_2_2 > 0 |
                                                               g148_2_3 > 0 |
                                                               g148_2_5 > 0 |
                                                               g148_2_6 > 0 |
                                                               g148_2_7 > 0 |
                                                               g148_2_8 > 0 |
                                                               g148_2_9 > 0 |
                                                               g148_2_10 > 0 |
                                                               g148_2_11 > 0, 1, 0))

# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de mayores de 65 años que perciben pensión

a_mes <- sem1_svy %>%
  srvyr::filter(tramo_edad == 5 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(pens, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_implant_svy %>%
  srvyr::filter(tramo_edad == 5 & (region_4 == 1 | region_4 == 2)) %>%
  srvyr::summarise(colname = srvyr::survey_mean(pens, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano_pu <- mean(c(a_sem, b_sem))
c_ano_pu <- as.data.frame(c_ano_pu)
c_ano_pu <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano_pu <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [23,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 



<br />

## **Suficiencia de las transferencias contributivas** 

<div style="text-align: justify">

Los siguientes gráficos son indicativos de la suficiencia de ingresos jubilatorios. El primer inicador muestra el porcentaje de jubilados cuyos ingresos mensuales se encuentran por debajo del salario mínimo nacional. El segundo indicador da cuenta de la poroporción de esta población cuyo ingreso se encuentra por debajo de la línea de pobreza individual (definida para la población que reside en hogares unipersonales). El primer indicador presenta un aumento durante el período, mientras el segundo un importante descenso. 
</div>

<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE PERSONAS QUE PERCIBEN JUBILACIONES POR DEBAJO DEL SALARIO MÍNIMO NACIONAL",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas que perciben jubilaciones por debajo del salario mínimo nacional**
##### Total país, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE PERSONAS QUE PERCIBEN JUBILACIONES POR DEBAJO DEL SALARIO MÍNIMO NACIONAL", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "TOTAL PAÍS", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "TOTAL PAÍS"~"Total pais"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 4, color = UNIDAD))+
  scale_color_manual(
    values = c(639),
      ) +
  ylim(0, 100) +
  scale_x_continuous(breaks=seq(2006, 2021, 2)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE PERSONAS QUE PERCIBEN JUBILACIONES POR DEBAJO DEL SALARIO MÍNIMO NACIONAL", URBANORURALUY == "TOTAL PAÍS", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "TOTAL PAIS"~"Total pais"))  %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO, t1$UNIDAD_GEOGRÁFICA), ]

DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [27,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [27,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###

smn <- 17930
smn_h = smn/200

# Percepción de jubilaciones

sem1 <- sem1 %>% dplyr::mutate(jub = ifelse(G148_1_1 > 0 |
                                              G148_1_2 > 0 |
                                              G148_1_3 > 0 |
                                              G148_1_4 > 0 |
                                              G148_1_5 > 0 |
                                              G148_1_6 > 0 |
                                              G148_1_7 > 0 |
                                              G148_1_8 > 0 |
                                              G148_1_9 > 0 |
                                              G148_1_10 > 0 |
                                              G148_1_11 > 0, 1, 0))

sem2_implant <- sem2_implant %>% dplyr::mutate(jub = ifelse(g148_1_1 > 0 |
                                                              g148_1_2 > 0 |
                                                              g148_1_3 > 0 |
                                                              g148_1_5 > 0 |
                                                              g148_1_6 > 0 |
                                                              g148_1_7 > 0 |
                                                              g148_1_8 > 0 |
                                                              g148_1_9 > 0 |
                                                              g148_1_10 > 0 |
                                                              g148_1_11 > 0, 1, 0))

# Ingresos por jubilaciones

sem1 <- sem1 %>% dplyr::mutate(y_jub = G148_1_1 + 
                                 G148_1_2 + 
                                 G148_1_3 + 
                                 G148_1_4 + 
                                 G148_1_5 + 
                                 G148_1_6 + 
                                 G148_1_7 + 
                                 G148_1_8 + 
                                 G148_1_9 + 
                                 G148_1_12 + 
                                 G148_1_10 + 
                                 G148_1_11)
sem2_implant <- sem2_implant %>% dplyr::mutate(y_jub = g148_1_1 +
                                                 g148_1_2 + 
                                                 g148_1_3 + 
                                                 g148_1_5 + 
                                                 g148_1_6 + 
                                                 g148_1_7 + 
                                                 g148_1_8 + 
                                                 g148_1_9 + 
                                                 g148_1_12 + 
                                                 g148_1_10 + 
                                                 g148_1_11)

# Ingresos por jubilaciones por debajo del salario mínimo nacional


sem1 <- sem1 %>% 
  dplyr::mutate(jub_insuf_smn = ifelse(y_jub < smn, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(jub_insuf_smn = ifelse(y_jub < smn, 1, 0))


# Región

sem1 <- sem1 %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))

sem2_implant <- sem2_implant %>% 
  dplyr::mutate(bd_region = case_when(region_4 == 1 | region_4 == 2 ~ 1,
                                      region_4 == 3 ~ 2,
                                      region_4 == 4 ~ 3))



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de personas que perciben jubilaciones por debajo del SMN

a_mes <- sem1_svy %>%
  srvyr::filter(tramo_edad == 5  %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(pens, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_implant_svy %>%
  srvyr::filter(tramo_edad == 5  %>%
  srvyr::summarise(colname = srvyr::survey_mean(pens, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano <- mean(c(a_sem, b_sem))
c_ano <- as.data.frame(c_ano_pu)
c_ano <- c_ano_pu %>% dplyr::mutate(aux = 1)
c_ano <- c_ano_pu %>% dplyr::rename(VALOR = c_ano_pu)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```


## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [27,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE PERSONAS QUE PERCIBEN JUBILACIONES POR DEBAJO DE LA LÍNEA DE POBREZA",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de personas que perciben jubilaciones por debajo de la línea de pobreza**
##### Total país, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE PERSONAS QUE PERCIBEN JUBILACIONES POR DEBAJO DE LA LÍNEA DE POBREZA", SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "TOTAL PAÍS", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 4, color = UNIDAD))+
  scale_color_manual(
    values = c(639),
      ) +
  ylim(0, 75) +
  scale_x_continuous(breaks=seq(2006, 2021, 2)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE PERSONAS QUE PERCIBEN JUBILACIONES POR DEBAJO DE LA LÍNEA DE POBREZA", URBANORURALUY == "TOTAL PAÍS", 
  SEXO == "TODOS", ASCENDENCIA == "TODOS", `QUINTIL DE INGRESO` == "TODOS", edad == 0, pobr == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO, t1$UNIDAD_GEOGRÁFICA), ]

DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [25,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [25,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Línea de pobreza individual

sem1 <- sem1 %>% dplyr::mutate(regionlp = case_when(region_4 == 1 ~ 1,
                                                    region_4 == 2 | region_4 == 3 ~ 2,
                                                    region_4 == 4 ~ 3))


sem1 <- sem1 %>% dplyr::mutate(grupolp = case_when(regionlp == 1 & mes == 1 ~ 1,
                                                   regionlp == 1 & mes == 2 ~ 2,
                                                   regionlp == 1 & mes == 3 ~ 3,
                                                   regionlp == 1 & mes == 4 ~ 4,
                                                   regionlp == 1 & mes == 5 ~ 5,
                                                   regionlp == 1 & mes == 6 ~ 6,
                                                   regionlp == 2 & mes == 1 ~ 7,
                                                   regionlp == 2 & mes == 2 ~ 8,
                                                   regionlp == 2 & mes == 3 ~ 9,
                                                   regionlp == 2 & mes == 4 ~ 10,
                                                   regionlp == 2 & mes == 5 ~ 11,
                                                   regionlp == 2 & mes == 6 ~ 12,
                                                   regionlp == 3 & mes == 1 ~ 13,
                                                   regionlp == 3 & mes == 2 ~ 14,
                                                   regionlp == 3 & mes == 3 ~ 15,
                                                   regionlp == 3 & mes == 4 ~ 16,
                                                   regionlp == 3 & mes == 5 ~ 17,
                                                   regionlp == 3 & mes == 6 ~ 18))

sem1_unipersonales <- sem1 %>%  filter(ht19==1)
sem1_unipersonales <- sem1_unipersonales[,c("numero","grupolp", "lp_06")]
sem1_unipersonales <- sem1_unipersonales %>% dplyr::mutate(lp_unipersonales = lp_06)
sem1_unipersonales <- sem1_unipersonales[order(sem1_unipersonales$grupolp, sem1_unipersonales$lp_unipersonales, decreasing = TRUE), ]
sem1_unipersonales <- sem1_unipersonales %>% distinct(grupolp, .keep_all = TRUE)
sem1_unipersonales <- sem1_unipersonales[,c("grupolp","lp_unipersonales")]

sem1 <- merge(sem1, sem1_unipersonales, by = "grupolp")


sem2_implant <- sem2_implant %>% dplyr::mutate(regionlp = case_when(region_4 == 1 ~ 1,
                                                                    region_4 == 2 | region_4 == 3 ~ 2,
                                                                    region_4 == 4 ~ 3))


sem2_implant <- sem2_implant %>% dplyr::mutate(grupolp = case_when(regionlp == 1 & mes == 7 ~ 1,
                                                                   regionlp == 1 & mes == 8 ~ 2,
                                                                   regionlp == 1 & mes == 9 ~ 3,
                                                                   regionlp == 1 & mes == 10 ~ 4,
                                                                   regionlp == 1 & mes == 11 ~ 5,
                                                                   regionlp == 1 & mes == 12 ~ 6,
                                                                   regionlp == 2 & mes == 7 ~ 7,
                                                                   regionlp == 2 & mes == 8 ~ 8,
                                                                   regionlp == 2 & mes == 9 ~ 9,
                                                                   regionlp == 2 & mes == 10 ~ 10,
                                                                   regionlp == 2 & mes == 11 ~ 11,
                                                                   regionlp == 2 & mes == 12 ~ 12,
                                                                   regionlp == 3 & mes == 7 ~ 13,
                                                                   regionlp == 3 & mes == 8 ~ 14,
                                                                   regionlp == 3 & mes == 9 ~ 15,
                                                                   regionlp == 3 & mes == 10 ~ 16,
                                                                   regionlp == 3 & mes == 11 ~ 17,
                                                                   regionlp == 3 & mes == 12 ~ 18))

sem2_implant_unipersonales <- sem2_implant %>%  filter(ht19==1)
sem2_implant_unipersonales <- sem2_implant_unipersonales[,c("grupolp", "lp")]
sem2_implant_unipersonales <- sem2_implant_unipersonales %>% dplyr::mutate(lp_unipersonales = lp)
sem2_implant_unipersonales <- sem2_implant_unipersonales[order(sem2_implant_unipersonales$grupolp, sem2_implant_unipersonales$lp_unipersonales, decreasing = TRUE), ]
sem2_implant_unipersonales <- sem2_implant_unipersonales %>% distinct(grupolp, .keep_all = TRUE)
sem2_implant_unipersonales <- sem2_implant_unipersonales[,c("grupolp","lp_unipersonales")]

sem2_implant <- merge(sem2_implant, sem2_implant_unipersonales, by = "grupolp")


# Percepción de jubilaciones

sem1 <- sem1 %>% dplyr::mutate(jub = ifelse(G148_1_1 > 0 |
                                              G148_1_2 > 0 |
                                              G148_1_3 > 0 |
                                              G148_1_4 > 0 |
                                              G148_1_5 > 0 |
                                              G148_1_6 > 0 |
                                              G148_1_7 > 0 |
                                              G148_1_8 > 0 |
                                              G148_1_9 > 0 |
                                              G148_1_10 > 0 |
                                              G148_1_11 > 0, 1, 0))

sem2_implant <- sem2_implant %>% dplyr::mutate(jub = ifelse(g148_1_1 > 0 |
                                                              g148_1_2 > 0 |
                                                              g148_1_3 > 0 |
                                                              g148_1_5 > 0 |
                                                              g148_1_6 > 0 |
                                                              g148_1_7 > 0 |
                                                              g148_1_8 > 0 |
                                                              g148_1_9 > 0 |
                                                              g148_1_10 > 0 |
                                                              g148_1_11 > 0, 1, 0))

# Ingresos por jubilaciones

sem1 <- sem1 %>% dplyr::mutate(y_jub = G148_1_1 + 
                                 G148_1_2 + 
                                 G148_1_3 + 
                                 G148_1_4 + 
                                 G148_1_5 + 
                                 G148_1_6 + 
                                 G148_1_7 + 
                                 G148_1_8 + 
                                 G148_1_9 + 
                                 G148_1_12 + 
                                 G148_1_10 + 
                                 G148_1_11)
sem2_implant <- sem2_implant %>% dplyr::mutate(y_jub = g148_1_1 +
                                                 g148_1_2 + 
                                                 g148_1_3 + 
                                                 g148_1_5 + 
                                                 g148_1_6 + 
                                                 g148_1_7 + 
                                                 g148_1_8 + 
                                                 g148_1_9 + 
                                                 g148_1_12 + 
                                                 g148_1_10 + 
                                                 g148_1_11)



# Ingresos por jubilaciones por debajo de la línea de pobreza

sem1 <- sem1 %>% 
  dplyr::mutate(jub_insuf = ifelse(y_jub < lp_unipersonales, 1, 0))
sem2_implant <- sem2_implant %>% 
  dplyr::mutate(jub_insuf = ifelse(y_jub < lp_unipersonales, 1, 0)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de personas que perciben jubilaciones por debajo de la línea de pobreza

a_mes <- sem1_svy %>%
  srvyr::filter(jub == 1) %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(jub_insuf, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))

b_mes <- sem2_implant_svy %>%
  srvyr::filter(jub == 1) %>%
  srvyr::summarise(colname = srvyr::survey_mean(jub_insuf, na.rm=T))

b_sem <- mean(as.numeric(b_mes$colname))

c_ano <- mean(c(a_sem, b_sem))
c_ano <- as.data.frame(c_ano)
c_ano <- c_ano %>% dplyr::mutate(aux = 1)
c_ano <- c_ano %>% dplyr::rename(VALOR = c_ano)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [25,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />

## **Cobertura de las transferencias no contributivas** 

<div style="text-align: justify">

Los siguientes gráficos presentan el porcentaje de hogares que perciben Asignaciones Familiares - Plan de Equidad (AFAM-PE) y Tarjetas Uruguay Social (TUS) respectivamente. En 2020, un 13,4% de los hogares percibía AFAM y un 3,5% era perceptor de TUS. El primer indicador presenta una tendencia creciente hasta el año 2009 para el total país y decrece levemente a partir de esta fecha. El porcentaje de hogares que perciben TUS se ha mantenido constante en el período, con una disminución en 2020 y posterior aumento en 2021.
</div>

<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE HOGARES QUE PERCIBEN ASIGNACIONES FAMILIARES (SOLO PLAN DE EQUIDAD)",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```

##### **Porcentaje de hogares que perciben asignaciones familiares (Plan de equidad)**
##### Total país, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE HOGARES QUE PERCIBEN ASIGNACIONES FAMILIARES (SOLO PLAN DE EQUIDAD)", SEXO == "TODOS"|is.na(SEXO)==T, ASCENDENCIA == "TODOS"|is.na(ASCENDENCIA)==T, `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"|URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"|URBANORURALUY == "RURAL DISPERSO"|URBANORURALUY == "TOTAL PAÍS", edad == 0, pobr == 0, sjef == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"~"Urbano (Menos de 5.000 habitantes)", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"~"Urbano (Más de 5.000 habitantes)",URBANORURALUY == "RURAL DISPERSO"~ "Rural disperso", URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
  mutate(UNIDAD = factor(UNIDAD, levels = c("Urbano (Menos de 5.000 habitantes)", "Urbano (Más de 5.000 habitantes)", "Rural disperso", "Total país")))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 4, color = UNIDAD))+
  scale_color_manual(
    values = c(639, "#a1dd70","orangered","lightslategrey"),
      ) +
  ylim(0, 40) +
  scale_x_continuous(breaks=seq(2009, 2020, 1)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE HOGARES QUE PERCIBEN ASIGNACIONES FAMILIARES (SOLO PLAN DE EQUIDAD)", URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"|URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"|URBANORURALUY == "RURAL DISPERSO"|URBANORURALUY == "TOTAL PAÍS", 
  SEXO == "TODOS"|is.na(SEXO)==T, ASCENDENCIA == "TODOS"|is.na(ASCENDENCIA)==T, `QUINTIL DE INGRESO` == "TODOS", edad == 0, pobr == 0, sjef == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"~"Urbano (Menos de 5.000 habitantes)", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"~"Urbano (Más de 5.000 habitantes)",URBANORURALUY == "RURAL DISPERSO"~ "Rural disperso", URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
  mutate(UNIDAD = factor(UNIDAD, levels = c("Urbano (Menos de 5.000 habitantes)", "Urbano (Más de 5.000 habitantes)", "Rural disperso", "Total país")))  %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO, t1$UNIDAD_GEOGRÁFICA), ]

DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [31,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [31,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###


# Captación AFAM

sem1 <- sem1 %>% dplyr::mutate(afam_pe = ifelse((G152 == 1 & F73 != 2 & F92 !=2 ) | 
                                                  (G150 == 1 & (POBPCOAC %in% c(1, 3, 4, 6, 7, 8, 11) | 
                                                                  (POBPCOAC == 2 & F82 != 1 & F96 != 1))), 1, 0),   
                               afam_cont = ifelse(G150 == 1 & afam_pe == 0, 1, 0),
                               afam_total = ifelse(afam_pe == 1 | afam_cont == 1, 1, 0)) 

sem1_afam <- sem1[,c("numero","afam_pe", "afam_cont", "afam_total")]
sem1_afam <- sem1_afam %>% dplyr::mutate(h_afam_pe = afam_pe,
                                         h_afam_cont = afam_cont,
                                         h_afam_total = afam_total)

sem1_afam_1 <- sem1_afam[order(sem1_afam$numero, sem1_afam$h_afam_pe, decreasing = TRUE), ]
sem1_afam_2 <- sem1_afam[order(sem1_afam$numero, sem1_afam$h_afam_cont, decreasing = TRUE), ]
sem1_afam_3 <- sem1_afam[order(sem1_afam$numero, sem1_afam$h_afam_total, decreasing = TRUE), ]

sem1_afam_1 <- sem1_afam_1 %>% distinct(numero, .keep_all = TRUE)
sem1_afam_2 <- sem1_afam_2 %>% distinct(numero, .keep_all = TRUE)
sem1_afam_3 <- sem1_afam_3 %>% distinct(numero, .keep_all = TRUE)

sem1_afam_1 <- sem1_afam_1[,c("numero","h_afam_pe")]
sem1_afam_2 <- sem1_afam_2[,c("numero","h_afam_cont")]
sem1_afam_3 <- sem1_afam_3[,c("numero","h_afam_total")]

sem1 <- merge(sem1, sem1_afam_1, by = "numero")
sem1 <- merge(sem1, sem1_afam_2, by = "numero")
sem1 <- merge(sem1, sem1_afam_3, by = "numero")


sem2_implant <- sem2_implant %>% 
  dplyr::mutate(afam_pe = ifelse((g152 == 1 & f73 != 2 & f92 !=2 ) | 
                                 (g150 == 1 & (pobpcoac %in% c(1, 3, 4, 6, 7, 8, 11) | 
                                                 (pobpcoac == 2 & f82 != 1 & f96 != 1))), 1, 0),   
                                               afam_cont = ifelse(g150 == 1 & afam_pe == 0, 1, 0),
                                               afam_total = ifelse(afam_pe == 1 | afam_cont == 1, 1, 0)) 

sem2_afam <- sem2_implant[,c("ID","afam_pe", "afam_cont", "afam_total")]
sem2_afam <- sem2_afam %>% dplyr::mutate(h_afam_pe = afam_pe,
                                         h_afam_cont = afam_cont,
                                         h_afam_total = afam_total)

sem2_afam_1 <- sem2_afam[order(sem2_afam$ID, sem2_afam$h_afam_pe, decreasing = TRUE), ]
sem2_afam_2 <- sem2_afam[order(sem2_afam$ID, sem2_afam$h_afam_cont, decreasing = TRUE), ]
sem2_afam_3 <- sem2_afam[order(sem2_afam$ID, sem2_afam$h_afam_total, decreasing = TRUE), ]

sem2_afam_1 <- sem2_afam_1 %>% distinct(ID, .keep_all = TRUE)
sem2_afam_2 <- sem2_afam_2 %>% distinct(ID, .keep_all = TRUE)
sem2_afam_3 <- sem2_afam_3 %>% distinct(ID, .keep_all = TRUE)

sem2_afam_1 <- sem2_afam_1[,c("ID","h_afam_pe")]
sem2_afam_2 <- sem2_afam_2[,c("ID","h_afam_cont")]
sem2_afam_3 <- sem2_afam_3[,c("ID","h_afam_total")]

sem2_implant <- merge(sem2_implant, sem2_afam_1, by = "ID")
sem2_implant <- merge(sem2_implant, sem2_afam_2, by = "ID")
sem2_implant <- merge(sem2_implant, sem2_afam_3, by = "ID")


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de hogares que perciben AFAM (Solo Plan de Equidad)


a_mes <- sem1_h_svy %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(h_afam_pe, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))
a_sem <- as.data.frame(a_sem)

b_sem<- sem2_implant_h_svy %>%
  srvyr::summarise(colname = srvyr::survey_mean(h_afam_pe, na.rm=T))

b_sem<- select(b_sem, colname)

c_ano <- cbind(a_sem, b_sem)
c_ano <- c_ano %>% dplyr::mutate(VALOR = (a_sem + colname) /2)
c_ano <- c_ano %>% dplyr::mutate(aux = 1)
c_ano<- select(c_ano, c(VALOR, aux))


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}



```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [30,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


<br />


<div style="text-align: center">
```{r}
periodo <- base[base$NOMINDICADOR == "PORCENTAJE DE HOGARES QUE PERCIBEN TARJETA URUGUAY SOCIAL",]
max<- max(periodo$FECHA, na.rm = TRUE)
min<- min(periodo$FECHA, na.rm = TRUE)
periodo <- c(min," - ", max)
periodo_formatted <- paste(
  text_spec(periodo, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
##### **Porcentaje de hogares que perciben Tarjeta Uruguay Social**
##### Total país, `r periodo_formatted`
</div>

### {.tabset .tabset-fade .tabset-pills}
#### Gráfico


```{r, out.width='100%'}
#===============================================================================
g1 <- 
  base %>% filter(NOMINDICADOR == "PORCENTAJE DE HOGARES QUE PERCIBEN TARJETA URUGUAY SOCIAL", SEXO == "TODOS"|is.na(SEXO)==T, ASCENDENCIA == "TODOS"|is.na(ASCENDENCIA)==T, `QUINTIL DE INGRESO` == "TODOS", URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"|URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"|URBANORURALUY == "RURAL DISPERSO"|URBANORURALUY == "TOTAL PAÍS", edad == 0, pobr == 0, sjef == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"~"Urbano (Menos de 5.000 habitantes)", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"~"Urbano (Más de 5.000 habitantes)",URBANORURALUY == "RURAL DISPERSO"~ "Rural disperso", URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
  mutate(UNIDAD = factor(UNIDAD, levels = c("Urbano (Menos de 5.000 habitantes)", "Urbano (Más de 5.000 habitantes)", "Rural disperso", "Total país")))  %>%
  ggplot(aes(x = FECHA, y = VALOR)) +
  geom_line(aes(group = 4, color = UNIDAD))+
  scale_color_manual(
    values = c(639, "#a1dd70","orangered","lightslategrey"),
      ) +
  ylim(0, 20) +
  scale_x_continuous(breaks=seq(2015, 2021, 1)) +
  theme_minimal() +
  labs(
    color = "",
    title = "",
    caption = "Unidad de Métodos y Acceso a Datos (UMAD)",
    x = "",
    y = ""
  )
ggplotly(g1) %>% 
  config(displayModeBar = F) %>%
  layout(margin = list(b = 100), legend = list(x = 0.5, y = -0.1,orientation = "h", xanchor = "center" )) 

#===============================================================================
```

#### Tabla


```{r}
t1 <- 
  base %>% 
  filter(NOMINDICADOR =="PORCENTAJE DE HOGARES QUE PERCIBEN TARJETA URUGUAY SOCIAL", URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"|URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"|URBANORURALUY == "RURAL DISPERSO"|URBANORURALUY == "TOTAL PAÍS", 
  SEXO == "TODOS"|is.na(SEXO)==T, ASCENDENCIA == "TODOS"|is.na(ASCENDENCIA)==T, `QUINTIL DE INGRESO` == "TODOS", edad == 0, pobr == 0, sjef == 0) %>%
  mutate(VALOR = round(as.numeric(VALOR)*100,1)) %>% 
  mutate(UNIDAD = case_when(
  URBANORURALUY == "URBANO (MENOS DE 5.000 HABITANTES)"~"Urbano (Menos de 5.000 habitantes)", URBANORURALUY == "URBANO (MÁS DE 5.000 HABITANTES)"~"Urbano (Más de 5.000 habitantes)",URBANORURALUY == "RURAL DISPERSO"~ "Rural disperso", URBANORURALUY == "TOTAL PAÍS"~"Total país"))  %>%
  mutate(UNIDAD = factor(UNIDAD, levels = c("Urbano (Menos de 5.000 habitantes)", "Urbano (Más de 5.000 habitantes)", "Rural disperso", "Total país")))  %>%
  rename(UNIDAD_GEOGRÁFICA = URBANORURALUY) %>%
  rename(ANIO = FECHA)
t1 <- t1 [,c("NOMINDICADOR","PAÍS","UNIDAD_GEOGRÁFICA","ANIO","VALOR")]
t1 <- t1[order(t1$ANIO, t1$UNIDAD_GEOGRÁFICA), ]

DT::datatable(t1, extensions =  'Buttons', options =  list(dom = 'Bfrtip',
                                                       buttons = c('copy', 'csv', 'excel', 'print') )
) 
```

#### Ficha Técnica


```{r}
def <- strsplit(paste0(base_fichas [32,"DEFINICIÓN"])," ")[[1]]
def_formatted <- paste(
  text_spec(def, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Definición:** `r def_formatted`


```{r}
calc <- strsplit(paste0(base_fichas [32,"FORMA DE CÁLCULO"])," ")[[1]]
calc_formatted <- paste(
  text_spec(calc, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Forma de cálculo:** `r calc_formatted`


```{r}
nota <- strsplit(paste0(base_fichas [2,"Nota"])," ")[[1]]
nota_formatted <- paste(
  text_spec(nota, color = 1, font_size = 16, align = "justify"),
  collapse = " ")
```
> **Advertencia:** `r nota_formatted`

#### Código en R

```{r, echo=TRUE, eval=FALSE}

### Estimación de valores 2021 ###

# Para sintaxix de años anteriores consultar: 
# https://osf.io/dyzg8/files/osfstorage#

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de paquetes ###

# Instalar si es necesario:
#install.packages("rio")
#install.packages("srvyr")
#install.packages("tidyverse")

library(rio)
library(srvyr)
library(tidyverse)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Descarga bases ECH 2021 (INE) de repositorio UMAD-FCS ###

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65232781fc021200aab6", 
  destfile = "ECH2021_sem1.Rdata"
)

download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65616946a002027a4652", 
  destfile = "ECH2021_sem2_implant.Rdata"
)


download.file(
  url = "https://osf.io/dyzg8/files/osfstorage/63da65276946a001fe7a4630", 
  destfile = "ECH2021_sem2_panel.Rdata"
)

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Carga de bases ###

sem1          <- rio::import("ECH2021_sem1.Rdata")
sem2_implant  <- rio::import("ECH2021_sem2_implant.Rdata")
sem2_panel    <- rio::import("ECH2021_sem2_panel.Rdata")

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #


## Generación de nuevas variables ###



#  Captación TUS

sem1 <- sem1 %>% dplyr::mutate(tus = ifelse(E560==1, 1, 0))

sem1_tus <- sem1[,c("numero","tus")]
sem1_tus <- sem1_tus %>% dplyr::mutate(h_tus = tus)
sem1_tus <- sem1_tus[order(sem1_tus$numero, sem1_tus$h_tus, decreasing = TRUE), ]
sem1_tus <- sem1_tus %>% distinct(numero, .keep_all = TRUE)
sem1_tus <- sem1_tus[,c("numero","h_tus")]
sem1 <- merge(sem1, sem1_tus, by = "numero")


sem2_implant <- sem2_implant %>% dplyr::mutate(tus = ifelse(e560==1, 1, 0))

sem2_tus <- sem2_implant[,c("ID","tus")]
sem2_tus <- sem2_tus %>% dplyr::mutate(h_tus = tus)
sem2_tus <- sem2_tus[order(sem2_tus$ID, sem2_tus$h_tus, decreasing = TRUE), ]
sem2_tus <- sem2_tus %>% distinct(ID, .keep_all = TRUE)
sem2_tus <- sem2_tus[,c("ID","h_tus")]
sem2_implant <- merge(sem2_implant, sem2_tus, by = "ID")



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Bases a nivel hogar ###                               

sem1_h <- sem1 %>% distinct(numero, .keep_all = TRUE)
sem2_implant_h <- sem2_implant %>% distinct(ID, .keep_all = TRUE)


# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Información de muestreo ###

sem1 <- sem1 %>% dplyr::mutate(pesosem = pesomen / 6)


sem1_svy           <- srvyr::as_survey_design(sem1, 
                                              ids = numero, 
                                              weights = pesomen)

sem1_h_svy         <- srvyr::as_survey_design(sem1_h, 
                                              ids = numero, 
                                              weights = pesomen)

sem2_implant_svy   <- srvyr::as_survey_design(sem2_implant, 
                                              ids = ID, 
                                              weights = w_sem)

sem2_implant_h_svy <- srvyr::as_survey_design(sem2_implant_h, ids = ID, 
                                              weights = w_sem)

sem2_panel_svy   <-  srvyr::as_survey_design(sem2_panel, 
                                             ids = ID, 
                                             weights = w)



# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

### Estimación de indicadores ###


###  Porcentaje de hogares que perciben TUS


a_mes <- sem1_h_svy %>%
  srvyr::group_by(mes) %>%
  srvyr::summarise(colname = srvyr::survey_mean(h_tus, na.rm=T))

a_sem <- mean(as.numeric(a_mes$colname))
a_sem <- as.data.frame(a_sem)

b_sem<- sem2_implant_h_svy %>%
  srvyr::summarise(colname = srvyr::survey_mean(h_tus, na.rm=T))

b_sem<- select(b_sem, colname)

c_ano <- cbind(a_sem, b_sem)
c_ano <- c_ano %>% dplyr::mutate(VALOR = (a_sem + colname) /2)
c_ano <- c_ano %>% dplyr::mutate(aux = 1)
c_ano<- select(c_ano, c(VALOR, aux))

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

 
```

## {.toc-ignore .unlisted .unnumbered}


```{r}
cita <- strsplit(paste0("Fuente: ", base_fichas [32,"FUENTE"])," ")[[1]]
cita_formatted <- paste(
  text_spec(cita, color = 1, font_size = 12, align = 2),
  collapse = " ")
```
`r cita_formatted` 


# **Referencias**	

## **Sistema de consultas**

Acceda a nuestro sistema de consultas personalizado de indicadores de empleo, salarios y transferencias en el siguiente [link](https://bancodedatos-fcs.shinyapps.io/app-Empleo-Salarios-Transferencias/).


## **Contacto**	

Si tiene consultas, sugerencias, comentarios o encontró algún error en este documento, le agradecemos que se contacte con nosotros/as.

**Contacto: umad@cienciassociales.edu.uy**